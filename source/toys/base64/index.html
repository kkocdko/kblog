<!DOCTYPE html>
<head>
  <meta name="viewport" content="width=device-width" />
  <base href="/toy/base64/" />
  <link
    rel="stylesheet"
    href="//cdn.jsdelivr.net/npm/material-components-web@6.0.0/dist/material-components-web.min.css"
  />
  <link rel="stylesheet" href="../misc/material-components-web-kmod.css" />
  <script src="//cdn.jsdelivr.net/npm/material-components-web@6.0.0/dist/material-components-web.min.js"></script>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="rgb(98, 0, 238)" />
  <!-- [material-design-icons](https://github.com/google/material-design-icons) -->
  <link rel="icon" href="favicon.svg" />
  <title>Base64 Tool</title>
</head>
<style>
  body {
    max-width: 350px;
    height: auto;
  }

  #main-panel {
    display: grid;
    gap: 20px;
  }

  #input-file {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
    width: 100%;
    height: 100%;
    cursor: pointer;
    opacity: 0;
  }

  #output-box {
    padding-right: 5em;
  }

  #copy-btn {
    position: absolute;
    right: 0;
    z-index: 1;
    height: 100%;
    font-size: 12px;
  }
</style>
<body>
  <div id="main-panel" class="mdc-card">
    <label
      id="select-file-btn"
      class="mdc-button mdc-button--raised"
      data-mdc-auto-init="MDCRipple"
    >
      <input id="input-file" type="file" autocomplete="off" />
      <span class="mdc-button__ripple"></span>
      Select File
    </label>
    <div
      class="mdc-text-field mdc-text-field--outlined"
      data-mdc-auto-init="MDCTextField"
    >
      <input
        id="output-box"
        class="mdc-text-field__input"
        readonly
        spellcheck="false"
        spellcheck="false"
        autocapitalize="off"
        autocomplete="off"
        autocorrect="off"
      />
      <div class="mdc-notched-outline">
        <div class="mdc-notched-outline__leading"></div>
        <div class="mdc-notched-outline__notch">
          <label for="text-field-hero-input" class="mdc-floating-label">
            Base64 Output
          </label>
        </div>
        <div class="mdc-notched-outline__trailing"></div>
      </div>
      <button id="copy-btn" class="mdc-button" data-mdc-auto-init="MDCRipple">
        <span class="mdc-button__ripple"></span>
        Copy
      </button>
    </div>
  </div>
</body>
<script>
  "use strict";

  mdc.autoInit();
  navigator.serviceWorker.register("sw.js");

  const inputFile = document.querySelector("#input-file");
  const copyBtn = document.querySelector("#copy-btn");
  const outputBox = document.querySelector("#output-box");

  let currentBase64 = "";

  inputFile.addEventListener("change", () => {
    const file = inputFile.files[0];
    if (file.size > 1024 ** 2 * 1) {
      alert("Input file must small than 1 MB"); // todo: bigger file
      return;
    }
    const fileReader = new FileReader();
    fileReader.onload = (event) => {
      currentBase64 = event.target.result;
      outputBox.value = currentBase64;
      outputBox.select();
      inputFile.value = null;
    };
    fileReader.readAsDataURL(file);
  });

  copyBtn.addEventListener("click", () => {
    if (currentBase64) {
      outputBox.select();
      document.execCommand("copy");
    } else {
      alert("select a file first");
    }
  });
</script>
