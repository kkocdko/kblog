<!DOCTYPE html>

<head>
  <base href="/toy/base64/" />
  <script>
    __VEPS_CFG__ = {
      name: "Base64 Tool",
      description: "Encode base64.",
      background: "rgb(248, 249, 250)",
      themeColor: "rgb(98, 0, 238)",
      icon: `48 | 48 | <path d="M18 32.34L9.66 24l-2.83 2.83L18 38l24-24-2.83-2.83z"/>`,
      ver: "0.0.1",
    };
  </script>
  <script veps-main src="../veps.js"></script>
</head>

<veps-deps>
  <link rel="stylesheet" href="dark-mode.css" />
</veps-deps>

<main>
  <label for="input-file">Select File</label>
  <input id="input-file" type="file" autocomplete="off" />
  <input id="output-box" readonly spellcheck="false" autocomplete="off" />
  <button id="copy-btn">Copy</button>
</main>

<script>
  "use strict";

  const inputFile = document.querySelector("#input-file");
  const outputBox = document.querySelector("#output-box");
  const copyBtn = document.querySelector("#copy-btn");

  let currentBase64 = "";

  inputFile.addEventListener("change", () => {
    const file = inputFile.files[0];
    if (file.size > 1024 ** 2 * 1) {
      alert("Input file must small than 1 MB"); // todo: bigger file
      return;
    }
    const fileReader = new FileReader();
    fileReader.onload = (event) => {
      currentBase64 = event.target.result;
      outputBox.value = currentBase64;
      outputBox.select();
      inputFile.value = null;
    };
    fileReader.readAsDataURL(file);
  });

  copyBtn.addEventListener("click", () => {
    if (currentBase64) {
      outputBox.select();
      document.execCommand("copy");
    } else {
      alert("select a file first");
    }
  });
</script>

<style>
  *,
  *::before,
  *::after {
    box-sizing: border-box;
    padding: 0;
    margin: 0;
  }

  main {
    display: grid;
    margin: 10px;
  }

  main > * {
    height: 35px;
    padding: 5px;
    margin: 5px 0;
    text-align: center;
    border: 1px solid #777;
    border-radius: 4px;
  }

  #input-file {
    display: none;
  }
</style>
