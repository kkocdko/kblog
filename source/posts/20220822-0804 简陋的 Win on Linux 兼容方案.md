```
title: 简陋的 Win on Linux 兼容方案
date: 2022.08.10 11:54
tags: Tutorial Linux Windows QEMU
description: （正在施工）
```

## 未完成，有空再写

成品：

<https://1drv.ms/u/s!AndLPYbx5v06kh_hMRzLhgoTqOvN>

<https://pan.baidu.com/s/1M0zD537bNU5i78pcIyYk_w>

本页是《 LSW - 简陋的 Linux 上的 Win 兼容方案 》的目录。各篇链接如下：

0. 目录，起源

1. 选型：比较方案，协议限制

2. 制作：配置选项，选择镜像，装载，调整缩放

3. 交互：文件共享，网络

4. 应用：常用软件与技巧，搜狗五笔输入法

5. 优化：快照，差分，减小镜像体积，纯净化

```sh
# use udf to support long file name
mkisofs -udf -o share.iso ./share
qemu-img create -f qcow2 -o compression_type=zstd,preallocation=off win10.qcow2 32G
qemu-kvm -cdrom /run/media/kkocdko/data/win/pkgs/WinPE/WePE_2.2_10-64.iso -drive file=win10.qcow2 -drive file=share.iso,media=cdrom -boot once=d -m 1.5G -cpu host -accel kvm -smp 2
qemu-img convert -p -f qcow2 -O qcow2 -c -o compression_type=zstd,preallocation=off win10.qcow2 win10-zstd.qcow2
qemu-kvm -drive file=win10.qcow2 -m 1.5G -cpu host -accel kvm -smp 2

qemu-img create -f qcow2 -b win10_71c68d8d.qcow2 -F qcow2 -o compression_type=zstd snapshot.qcow2

qemu-kvm -cdrom /run/media/kkocdko/data/win/pkgs/WinPE/WePE_2.2_10-64.iso -drive file=win10.qcow2 -drive file=win10_old.qcow2 -drive file=share.iso,media=cdrom -boot once=d -m 2G -cpu host -accel kvm -smp 4


缩放调成100
自动启动挂载光盘中的batch
进一步减小体积

ide channel limit, if too many cdrom mount ,error

```

| Scale | DPI | DPI (Hex) | Name        |
| ----- | --- | --------- | ----------- |
| 100 % | 96  | 0x0060    | default     |
| 125 % | 120 | 0x0078    | medium      |
| 150 % | 144 | 0x0090    | larger      |
| 200 % | 192 | 0x00c0    | extra-large |
| 250 % | 240 | 0x00f0    | custom      |
| 300 % | 288 | 0x0120    | custom      |
| 400 % | 384 | 0x0180    | custom      |
| 500 % | 480 | 0x01e0    | custom      |

```
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon]
"DefaultUserName"="Administrator"
"ForceUnlockLogon"=dword:00000001
"AutoAdminLogon"="1"
"DefaultPassword"=""
"ForceAutoLogon"=dword:00000001

[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Serialize]
"StartupDelayInMSec"=dword:00000000
```

最近在尝试努力弄出一个方便的 Win10 镜像，在 QEMU 中运行，以满足我偶尔的使用 Windows 的需求。我希望让这个镜像足够小，只读，并且让

1. 请区分“收缩”和“压缩”的区别。不能混为一谈。

2. 在磁盘镜像中写入文件，镜像会被“撑开”。删除了文件后，要想让镜像回到原本的大小，需要“收缩”镜像。

3. 不要使用 Virtual Disk Precompactor，直接复制并修复引导。最好是单线程，减少碎片。

4. `NTFS` 压缩 无效

5. QEMU 的 `qcow2`

6. snapshot
